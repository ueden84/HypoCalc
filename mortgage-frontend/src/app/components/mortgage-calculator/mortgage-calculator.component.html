<mat-card class="calculator-card">
  <mat-card-header>
    <mat-card-title>Mortgage Calculator</mat-card-title>
    <mat-card-subtitle>Calculate your monthly mortgage payments</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="mortgageForm" (ngSubmit)="onSubmit()" class="calculator-form">
      <div class="field-container">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Principal Amount</mat-label>
          <input matInput type="text" [value]="getPrincipalDisplay()" placeholder="e.g., 3000000" (input)="onPrincipalInput($event)" (blur)="onPrincipalBlur()">
          <span matSuffix class="input-suffix">Kč</span>
          <mat-error *ngIf="mortgageForm.get('principal')?.hasError('required') && mortgageForm.get('principal')?.touched">
            Principal is required
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('principal')?.hasError('min')">
            Principal must be at least 0
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('principal')?.hasError('max')">
            Principal cannot exceed 20,000,000 Kč
          </mat-error>
        </mat-form-field>
          <mat-slider class="full-width" min="0" max="20000000" step="10000" discrete showTickMarks>
            <input matSliderThumb formControlName="principal">
          </mat-slider>
      </div>

      <div class="field-container">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Annual Interest Rate (%)</mat-label>
          <input matInput type="text" [value]="getInterestRateDisplay()" placeholder="např. 4,79" (input)="onInterestRateInput($event)" (blur)="onInterestRateBlur()">
          <span matSuffix class="input-suffix">%</span>
          <mat-error *ngIf="mortgageForm.get('annualRatePercent')?.hasError('required') && mortgageForm.get('annualRatePercent')?.touched">
            Interest rate is required
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('annualRatePercent')?.hasError('min')">
            Interest rate cannot be negative
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('annualRatePercent')?.hasError('max')">
            Interest rate cannot exceed 20%
          </mat-error>
        </mat-form-field>
          <mat-slider class="full-width" min="0" max="20" step="0.01" discrete showTickMarks>
            <input matSliderThumb formControlName="annualRatePercent">
          </mat-slider>
      </div>

      <div class="field-container">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Loan Term (Years)</mat-label>
          <input matInput type="text" [value]="getYearsDisplay()" placeholder="e.g., 30" (input)="onYearsInput($event)" (blur)="onYearsBlur()">
          <span matSuffix class="input-suffix">years</span>
          <mat-error *ngIf="mortgageForm.get('years')?.hasError('required') && mortgageForm.get('years')?.touched">
            Years is required
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('years')?.hasError('min')">
            Minimum loan term is 1 year
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('years')?.hasError('max')">
            Maximum loan term is 30 years
          </mat-error>
        </mat-form-field>
          <mat-slider class="full-width" min="1" max="30" step="1" discrete showTickMarks>
            <input matSliderThumb formControlName="years">
          </mat-slider>
      </div>

      <div class="field-container offset-section">
        <h3>Offset Account</h3>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Offset Amount</mat-label>
          <input matInput type="text" [value]="getOffsetDisplay()" placeholder="e.g., 100000" (input)="onOffsetInput($event)" (blur)="onOffsetBlur()">
          <span matSuffix class="input-suffix">Kč</span>
          <mat-error *ngIf="mortgageForm.get('offsetAmount')?.hasError('min')">
            Offset amount cannot be negative
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('offsetAmount')?.hasError('max')">
            Offset amount cannot exceed principal
          </mat-error>
        </mat-form-field>
        <mat-slider class="full-width" min="0" [max]="getOffsetMax()" step="10000" discrete showTickMarks>
          <input matSliderThumb formControlName="offsetAmount">
        </mat-slider>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Offset Account Interest Rate (%)</mat-label>
          <input matInput type="text" [value]="getOffsetRateDisplay()" placeholder="e.g., 3.5" (input)="onOffsetRateInput($event)" (blur)="onOffsetRateBlur()">
          <span matSuffix class="input-suffix">%</span>
          <mat-error *ngIf="mortgageForm.get('offsetRatePercent')?.hasError('min')">
            Offset rate cannot be negative
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('offsetRatePercent')?.hasError('maxRate')">
            Offset rate cannot exceed 20%
          </mat-error>
          <mat-error *ngIf="mortgageForm.get('offsetRatePercent')?.hasError('minRate')">
            Offset rate must be >= annual interest rate
          </mat-error>
        </mat-form-field>
        <mat-slider class="full-width" min="0" max="20" step="0.01" discrete showTickMarks>
          <input matSliderThumb formControlName="offsetRatePercent">
        </mat-slider>

        <mat-radio-group formControlName="offsetMode" class="offset-mode-group">
          <mat-radio-button value="reduceAmount">Reduce principal amount</mat-radio-button>
          <mat-radio-button value="reduceTerm">Reduce loan term</mat-radio-button>
        </mat-radio-group>
      </div>

      <button mat-raised-button color="primary" type="submit" [disabled]="mortgageForm.invalid || loading" class="full-width">
        <mat-spinner *ngIf="loading" diameter="20" class="inline-spinner"></mat-spinner>
        <span *ngIf="!loading">Calculate</span>
      </button>
    </form>

    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <mat-card *ngIf="result" class="results-card" id="results-section">
      <mat-card-header>
        <mat-card-title>Results</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="result-item" *ngIf="result.effectivePrincipal && result.effectivePrincipal !== result.monthlyPayment">
          <span class="result-label">Effective Principal:</span>
          <span class="result-value">{{ formatCurrency(result.effectivePrincipal) }}</span>
        </div>
        <div class="result-item" *ngIf="result.effectiveYears && result.effectiveYears > 0">
          <span class="result-label">Effective Term:</span>
          <span class="result-value">{{ result.effectiveYears }} years</span>
        </div>
        <div class="result-item">
          <span class="result-label">Monthly Payment:</span>
          <span class="result-value">{{ formatCurrency(result.monthlyPayment) }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total Paid:</span>
          <span class="result-value">{{ formatCurrency(result.totalPaid) }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total Interest:</span>
          <span class="result-value">{{ formatCurrency(result.totalInterest) }}</span>
        </div>
        <div class="result-item" *ngIf="result.totalOffsetInterestEarned && result.totalOffsetInterestEarned > 0">
          <span class="result-label">Offset Interest Earned:</span>
          <span class="result-value">{{ formatCurrency(result.totalOffsetInterestEarned) }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </mat-card-content>
</mat-card>
